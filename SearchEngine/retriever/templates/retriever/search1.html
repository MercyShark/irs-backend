<!DOCTYPE html>
<html>
  <head>
    <title>Search Documents</title>
    {% load bootstrap5 %} {% bootstrap_css %} {% bootstrap_javascript %}
  </head>
  <body>
    <h2>Search Documents</h2>
    <form method="post">
      {{ form.query }}
      <button type="submit" class="btn btn-success">Search</button>
    </form>
    <hr />

    {% if results %}
    <h3>{{ results.total_documents_found }} documents found.</h3>
    <h3>{{ results.total_documents}} documents in total.</h3>
    <h3>{{ results.time_taken}} milliseconds.</h3>
    {% endif %} {% for document in results.data %}
    <!-- <div class="paragraph">{{ document.highlighted_content }}</div> -->
    <div>
      <h5>{{ document.title }}</h5>
      <h3>{{ document.id }}</h3>
      <button
        type="button"
        class="btn btn-primary"
        data-bs-toggle="modal"
        data-bs-target="#myModal"
        data-modal-data="{{ document.highlighted_content }}"
        data-modal-title="{{ document.title }}"
      >
        View
      </button>
      <!-- Implement highlighting here -->
    </div>
    {% empty %}
    <p>No documents found.</p>
    {% endfor %}

    <!-- Button trigger modal -->
    <!-- Button trigger modal -->

    <!-- Modal -->
    <div
      class="modal fade"
      id="exampleModal"
      tabindex="-1"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">...</div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
            <button type="button" class="btn btn-primary">Save changes</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      function openModalWithData(data) {
        // Get modal body element
        var modalBody = document.querySelector("#exampleModal .modal-body");
        var modalTitle = document.querySelector("#exampleModal .modal-title");

        // Set modal title
        modalTitle.innerHTML = "<h5>" + data.modalTitle + "</h5>";
        // Clear existing content
        modalBody.innerHTML = "";

        // Populate modal body with data
        modalBody.innerHTML = "<p>" + data.modalData + "</p>";

        // Open the modal
        var myModal = new bootstrap.Modal(
          document.getElementById("exampleModal")
        );
        myModal.show();
      }

      // Button click event handler
      document.querySelectorAll(".btn-primary").forEach(function (btn) {
        btn.addEventListener("click", function () {
          // Get data attribute value
          var modalData = this.getAttribute("data-modal-data");
          var modalTitle = this.getAttribute("data-modal-title");
          dataToSend = {
            modalData: modalData,
            modalTitle: modalTitle,
          };

          // Open the modal with data
          openModalWithData(dataToSend);
        });
      });
    </script>
  </body>
</html>
